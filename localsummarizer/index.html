<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Transcript Summarizer</title>

  <!-- Cousine Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cousine:wght@400;700&display=swap" rel="stylesheet">

  <!-- Tailwind CSS v4 -->
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>

  <!-- Marked.js for Markdown rendering -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <style type="text/tailwindcss">
    @theme {
      /* Solarized Light Colors */
      --color-base-3: #fdf6e3;
      --color-base-2: #eee8d5;
      --color-base-1: #93a1a1;
      --color-base-00: #657b83;
      --color-base-01: #586e75;

      /* Accents */
      --color-sol-cyan: #2aa198;
      --color-sol-green: #859900;
      --color-sol-yellow: #b58900;
      --color-sol-orange: #cb4b16;
      --color-sol-red: #dc322f;

      /* Font */
      --font-mono: 'Cousine', 'Monaco', 'Consolas', monospace;
    }

    /* Custom animations */
    @keyframes fade-in-down {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes fade-in-up {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes pulse-glow {
      0%, 100% { box-shadow: 0 0 0 0 rgba(42, 161, 152, 0.4); }
      50% { box-shadow: 0 0 0 8px rgba(42, 161, 152, 0); }
    }

    @keyframes shimmer {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }

    /* Thinking section toggle */
    #thinking-chevron.expanded {
      transform: rotate(90deg);
    }

  </style>
</head>

<body class="font-mono bg-base-3 text-base-00 min-h-screen">
  <!-- Fixed background gradient -->
  <div class="fixed inset-0 -z-10"
       style="background:
         linear-gradient(135deg, #fdf6e3 0%, #eee8d5 100%),
         radial-gradient(circle at 20% 80%, rgba(42,161,152,0.08) 0%, transparent 50%);">
  </div>

  <!-- Header -->
  <header class="sticky top-0 z-50 px-6 lg:px-12 py-4 border-b border-base-1/20 bg-base-3/90 backdrop-blur-sm
                 animate-[fade-in-down_0.4s_cubic-bezier(0.4,0,0.2,1)_backwards]">
    <nav class="flex justify-between items-center max-w-[1400px] mx-auto">
      <div class="text-lg font-bold text-sol-cyan tracking-tight">
        Transcript Summarizer
      </div>
      <div id="status-badge" class="flex items-center gap-2 text-sm">
        <span class="w-2 h-2 rounded-full bg-base-1"></span>
        <span id="status-text">Initializing...</span>
      </div>
    </nav>
  </header>

  <!-- Main Content -->
  <main class="max-w-[1400px] mx-auto px-6 lg:px-12 py-8
               animate-[fade-in-up_0.6s_cubic-bezier(0.4,0,0.2,1)_backwards]">

    <!-- WebGPU Error Banner (hidden by default) -->
    <div id="webgpu-error" class="hidden mb-6 p-4 bg-sol-red/10 border border-sol-red/30 rounded text-sol-red">
      <strong>WebGPU Not Available</strong>
      <p class="text-sm mt-1">This app requires WebGPU support. Please use Chrome 113+, Edge 113+, or Safari 18+.</p>
    </div>

    <!-- Context Limit Error Banner (hidden by default) -->
    <div id="context-error" class="hidden mb-6 p-4 bg-sol-orange/10 border border-sol-orange/30 rounded text-sol-orange">
      <strong>Input Too Long</strong>
      <p id="context-error-message" class="text-sm mt-1"></p>
    </div>

    <!-- Main Content Area -->
    <div class="space-y-6">

        <!-- Input Section -->
        <section class="bg-base-2 border border-base-1/20 rounded p-6
                        shadow-[0_2px_8px_rgba(101,123,131,0.08)]">
          <div class="flex justify-between items-center mb-4">
            <h2 class="text-lg font-semibold">Input Transcript</h2>
            <span id="token-count" class="text-xs text-base-1">0 / 20,000 tokens</span>
          </div>

          <textarea
            id="transcript-input"
            placeholder="Paste your transcript here, or upload a file..."
            class="w-full h-64 px-4 py-3 bg-base-3 border border-base-1/20 rounded
                   text-[13px] text-base-00 font-mono resize-y
                   transition-all duration-200
                   focus:outline-none focus:border-sol-cyan focus:ring-[3px] focus:ring-sol-cyan/20"
          ></textarea>

          <div class="flex flex-wrap items-center justify-between gap-3 mt-4">
            <div class="flex flex-wrap gap-3">
              <label class="bg-transparent text-base-00 border border-base-1/30 px-5 py-2 text-sm rounded cursor-pointer
                            transition-all duration-150
                            hover:bg-base-3 hover:border-sol-cyan">
                <input type="file" id="file-upload" accept=".txt,.md,.vtt" class="hidden">
                Upload File
              </label>

              <button
                id="summarize-btn"
                disabled
                class="bg-sol-cyan text-base-3 px-6 py-2 text-sm font-semibold rounded
                       transition-all duration-150
                       hover:shadow-[0_4px_12px_rgba(42,161,152,0.3)] hover:-translate-y-0.5
                       active:scale-[0.98]
                       disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:shadow-none disabled:hover:translate-y-0">
                Summarize
              </button>

              <button
                id="stop-btn"
                class="hidden bg-sol-orange text-base-3 px-6 py-2 text-sm font-semibold rounded
                       transition-all duration-150
                       hover:shadow-[0_4px_12px_rgba(203,75,22,0.3)]">
                Stop
              </button>
            </div>

            <!-- Model Status (inline, right-aligned) -->
            <div id="loading-section" class="text-right text-xs text-base-01">
              <label class="inline-flex items-center gap-1.5 mr-3 cursor-pointer select-none
                            has-[:disabled]:opacity-50 has-[:disabled]:cursor-not-allowed">
                <input type="checkbox" id="webgpu-toggle" checked
                       class="w-3.5 h-3.5 accent-sol-cyan cursor-pointer disabled:cursor-not-allowed">
                <span>Use WebGPU</span>
              </label>
              <span id="loading-message">Checking WebGPU...</span>
              <div id="progress-container" class="inline-block ml-2"></div>
              <button
                id="load-model-btn"
                class="hidden ml-2 bg-sol-cyan text-base-3 px-3 py-1 text-xs font-semibold rounded
                       transition-all duration-150
                       hover:shadow-[0_4px_12px_rgba(42,161,152,0.3)]">
                Load Model
              </button>
            </div>

            <!-- Stats (inline, right-aligned, shown after completion) -->
            <div id="stats-section" class="hidden text-right text-xs text-base-01">
              <span id="stat-tokens">--</span> tokens |
              <span id="stat-chars">--</span> chars |
              <span id="stat-topics">--</span> topics
            </div>
          </div>
        </section>

        <!-- Thinking Section (collapsible) -->
        <section id="thinking-section" class="hidden bg-base-2 border border-base-1/20 rounded p-6
                        shadow-[0_2px_8px_rgba(101,123,131,0.08)]">
          <button id="thinking-toggle" class="w-full flex justify-between items-center text-left">
            <div class="flex items-center gap-2">
              <span id="thinking-chevron" class="text-base-1 transition-transform duration-200">&#9654;</span>
              <h2 class="text-lg font-semibold">Thinking</h2>
              <span id="thinking-status" class="text-xs text-base-1">(reasoning...)</span>
            </div>
          </button>
          <div id="thinking-content" class="mt-4">
            <pre id="thinking-output" class="text-[12px] text-base-01 whitespace-pre-wrap max-h-64 overflow-y-auto"></pre>
          </div>
        </section>

        <!-- Output Section -->
        <section id="output-section" class="hidden bg-base-2 border border-base-1/20 rounded p-6
                        shadow-[0_2px_8px_rgba(101,123,131,0.08)]">
          <div class="flex justify-between items-center mb-4">
            <h2 class="text-lg font-semibold">Summary</h2>
            <div class="flex gap-2">
              <button id="copy-btn" class="text-xs text-sol-cyan hover:underline">Copy</button>
              <button id="download-btn" class="text-xs text-sol-cyan hover:underline">Download</button>
            </div>
          </div>

          <div id="summary-output" class="prose prose-sm max-w-none text-[13px] leading-relaxed">
            <!-- Summary will be rendered here -->
          </div>
        </section>

        <!-- Streaming Preview (shown during processing) -->
        <section id="streaming-section" class="hidden bg-base-2 border border-base-1/20 border-l-[3px] border-l-sol-cyan rounded p-6">
          <div class="flex justify-between items-center mb-3">
            <h3 class="text-sm font-semibold">Generating Summary</h3>
            <span id="tps-display" class="text-xs text-base-1">-- tokens/sec</span>
          </div>
          <pre id="streaming-output" class="text-[12px] text-base-01 whitespace-pre-wrap max-h-48 overflow-y-auto"></pre>
        </section>
    </div>
  </main>

  <script type="module" src="./main.js"></script>

  <footer class="max-w-6xl mx-auto mt-12 pb-8 flex flex-wrap justify-center gap-4 text-xs tracking-wide text-base-1">
      <span class="text-base-01">A tool by Nick Lothian © 2026</span>
      <span class="text-base-01">·</span>
      <a href="https://x.com/nlothian" class="text-sol-cyan hover:text-base-01 transition-colors">X</a>
      <span class="text-base-01">·</span>
      <a href="https://bsky.app/profile/nlothian.bsky.social" class="text-sol-cyan hover:text-base-01 transition-colors">Bluesky</a>
      <span class="text-base-01">·</span>
      <a href="https://github.com/nlothian/tools/blob/main/localsummarizer" class="text-sol-cyan hover:text-base-01 transition-colors">source code</a>
      <span class="text-base-01">·</span>
      <a href="https://github.com/nlothian/tools/blob/main/LICENSE" class="text-sol-cyan hover:text-base-01 transition-colors">License</a>
  </footer>
</body>
</html>

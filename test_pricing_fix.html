<!DOCTYPE html>
<html>
<head>
    <title>Test Pricing Fix</title>
</head>
<body>
    <h1>Testing Pricing Data Fix</h1>
    <div id="testResults"></div>
    
    <script>
        // Test the pricing data initialization and usage
        let pricingData = [];
        
        // Mock fetch function for testing
        async function mockFetchPricingData() {
            try {
                // Simulate successful fetch
                pricingData = [
                    {
                        model: "gpt-4",
                        provider: "OpenAI",
                        input: 0.03,
                        output: 0.06
                    },
                    {
                        model: "claude-3-haiku",
                        provider: "Anthropic",
                        input: 0.0025,
                        output: 0.0125
                    }
                ];
                console.log('Mock pricing data loaded');
                return true;
            } catch (error) {
                console.error('Failed to load mock pricing data:', error);
                pricingData = [];
                return false;
            }
        }
        
        function getModelPricing(provider, modelName) {
            if (!pricingData || !Array.isArray(pricingData) || pricingData.length === 0) return null;

            const normalizedModel = modelName.toLowerCase();
            
            for (const item of pricingData) {
                const itemModel = (item.model || '').toLowerCase();
                const itemProvider = (item.provider || '').toLowerCase();
                
                if (itemModel.includes(normalizedModel) || normalizedModel.includes(itemModel)) {
                    if (provider === 'anthropic' && itemProvider.includes('anthropic')) {
                        return item;
                    } else if (provider === 'openai' && itemProvider.includes('openai')) {
                        return item;
                    } else if (provider === 'gemini' && itemProvider.includes('google')) {
                        return item;
                    } else if (provider === 'openrouter') {
                        return item;
                    }
                }
            }
            
            return null;
        }
        
        async function runTests() {
            const resultsDiv = document.getElementById('testResults');
            
            // Test 1: Initial state (empty array)
            let result1 = getModelPricing('openai', 'gpt-4');
            resultsDiv.innerHTML += `<p>Test 1 - Initial state: ${result1 === null ? 'PASS (returns null)' : 'FAIL'}</p>`;
            
            // Test 2: Load mock data
            const loadSuccess = await mockFetchPricingData();
            resultsDiv.innerHTML += `<p>Test 2 - Load mock data: ${loadSuccess ? 'PASS' : 'FAIL'}</p>`;
            
            // Test 3: Get pricing after loading data
            const result2 = getModelPricing('openai', 'gpt-4');
            resultsDiv.innerHTML += `<p>Test 3 - Get OpenAI pricing: ${result2 !== null ? 'PASS (found pricing)' : 'FAIL'}</p>`;
            
            // Test 4: Get Anthropic pricing
            const result3 = getModelPricing('anthropic', 'claude-3-haiku');
            resultsDiv.innerHTML += `<p>Test 4 - Get Anthropic pricing: ${result3 !== null ? 'PASS (found pricing)' : 'FAIL'}</p>`;
            
            // Test 5: Get non-existent model
            const result4 = getModelPricing('openai', 'non-existent-model');
            resultsDiv.innerHTML += `<p>Test 5 - Non-existent model: ${result4 === null ? 'PASS (returns null)' : 'FAIL'}</p>`;
            
            // Test 6: Test with empty pricing data
            pricingData = [];
            const result5 = getModelPricing('openai', 'gpt-4');
            resultsDiv.innerHTML += `<p>Test 6 - Empty pricing data: ${result5 === null ? 'PASS (returns null)' : 'FAIL'}</p>`;
            
            // Test 7: Test with null pricing data
            pricingData = null;
            const result6 = getModelPricing('openai', 'gpt-4');
            resultsDiv.innerHTML += `<p>Test 7 - Null pricing data: ${result6 === null ? 'PASS (returns null)' : 'FAIL'}</p>`;
        }
        
        runTests();
    </script>
</body>
</html>
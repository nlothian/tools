import{r as c,j as t,P as te,S as ae,L as se,B as ne,C as oe,a as re,b as le,c as ce,d as ie,e as de,A as ue,p as pe,f as ge,h as he,i as me}from"./charts-Bz0zeynE.js";oe.register(re,le,ce,ie,de,ue,pe,ge,he,me);const d=["#2aa198","#859900","#b58900","#cb4b16","#dc322f","#6c71c4","#d33682","#268bd2"];function v(u){if(u===null||u==="")return null;const l=Number(u);return Number.isFinite(l)?l:null}const _=20;function be(u){switch(u){case"numeric":return"(num)";case"text":return"(text)";case"date":return"(date)";case"boolean":return"(bool)";default:return"(other)"}}function z(u,l){if(u.length===0)return 0;switch(l){case"SUM":return u.reduce((j,a)=>j+a,0);case"AVG":return u.reduce((j,a)=>j+a,0)/u.length;case"COUNT":return u.length;case"MIN":return Math.min(...u);case"MAX":return Math.max(...u)}}function xe(u,l,j,a,x){const N=new Map,T=[],p=new Set;for(const n of u){const S=n[l]??"NULL",m=x?n[x]??"NULL":"__all__";p.add(m),N.has(S)||(N.set(S,new Map),T.push(S));const A=N.get(S);A.has(m)||A.set(m,{values:[]});const k=v(n[j]);k!==null&&A.get(m).values.push(k)}const Y=T,E=Array.from(p).map(n=>({category:n,data:Y.map(S=>{const m=N.get(S)?.get(n);return m?z(m.values,a):0})}));return{labels:Y,datasets:E}}const w={fontSize:11,fontFamily:"'Cousine', 'Monaco', 'Consolas', monospace",textTransform:"uppercase",letterSpacing:"0.05em",color:"var(--base-1)"},$={fontSize:11,fontFamily:"'Cousine', 'Monaco', 'Consolas', monospace",textTransform:"uppercase",letterSpacing:"0.05em",background:"transparent",border:"1px solid rgba(147, 161, 161, 0.2)",borderRadius:4,color:"var(--base-00)",cursor:"pointer",padding:"3px 8px"},fe={...$,background:"var(--sol-cyan)",color:"var(--base-3)",border:"1px solid var(--sol-cyan)"},ye={display:"flex",flexWrap:"wrap",gap:16,alignItems:"flex-start",padding:"8px 0",borderTop:"1px solid rgba(147, 161, 161, 0.15)",marginTop:4},Ce={display:"flex",flexWrap:"wrap",gap:"4px 12px",maxHeight:120,overflowY:"auto",fontSize:12,fontFamily:"'Cousine', 'Monaco', 'Consolas', monospace",color:"var(--base-00)"};function je({queryResult:u}){const{columns:l,columnTypes:j,rows:a}=u,x=c.useMemo(()=>j??{},[j]),N=c.useMemo(()=>l.find(s=>x[s]==="text"||x[s]==="date")??l[0]??"",[l,x]),T=c.useMemo(()=>l.find(s=>x[s]==="numeric")??l[1]??l[0]??"",[l,x]),[p,Y]=c.useState(N),[C,E]=c.useState(T),[n,S]=c.useState("bar"),[m,A]=c.useState(!1),[k,I]=c.useState([T]),[U,G]=c.useState(""),[B,P]=c.useState(!1),[R,H]=c.useState("SUM"),q=c.useMemo(()=>l.filter(e=>x[e]==="text"||x[e]==="other"),[l,x]),J=c.useCallback(e=>{I(s=>s.includes(e)?s.length===1?s:s.filter(i=>i!==e):[...s,e])},[]),F=m&&k.length>1&&!U,W=c.useMemo(()=>F?k:[C],[F,k,C]),M=m&&U?U:void 0,y=c.useMemo(()=>["scatter","pie"].includes(n)?[W[0]]:W,[n,W]),O=c.useMemo(()=>{if(m&&B){if(M){const{labels:r,datasets:b}=xe(a,p,C,R,M);return{labels:r,datasets:b.map((f,g)=>({label:f.category,data:f.data,backgroundColor:d[g%d.length]+"99",borderColor:d[g%d.length],borderWidth:1}))}}const i=y,o=new Map,h=[];for(const r of a){const b=r[p]??"NULL";o.has(b)||(o.set(b,{}),h.push(b));const f=o.get(b);for(const g of i){f[g]||(f[g]=[]);const L=v(r[g]);L!==null&&f[g].push(L)}}return{labels:h,datasets:i.map((r,b)=>({label:r,data:h.map(f=>{const g=o.get(f)?.[r]??[];return g.length>0?z(g,R):0}),backgroundColor:d[b%d.length]+"99",borderColor:d[b%d.length],borderWidth:n==="line"?2:1,pointRadius:n==="line"?2:void 0}))}}if(M){const i=Array.from(new Set(a.map(r=>r[M]??"NULL"))),o=Array.from(new Set(a.map(r=>r[p]??"NULL"))),h=new Map;for(const r of a){const b=r[p]??"NULL",f=r[M]??"NULL",g=`${b}|||${f}`;h.has(g)||h.set(g,[]);const L=v(r[C]);L!==null&&h.get(g).push(L)}return{labels:o,datasets:i.map((r,b)=>({label:r,data:o.map(f=>{const g=h.get(`${f}|||${r}`)??[];return g.length>0?g.reduce((L,ee)=>L+ee,0):0}),backgroundColor:d[b%d.length]+"99",borderColor:d[b%d.length],borderWidth:1}))}}if(F)return{labels:a.map(o=>o[p]??"NULL"),datasets:y.map((o,h)=>({label:o,data:a.map(r=>v(r[o])??0),backgroundColor:d[h%d.length]+"99",borderColor:d[h%d.length],borderWidth:n==="line"?2:1,pointRadius:n==="line"?2:void 0}))};const e=a.map(i=>i[p]??"NULL"),s=a.map(i=>v(i[C])??0);return{labels:e,datasets:[{label:C,data:s,backgroundColor:"rgba(42, 161, 152, 0.6)",borderColor:"#2aa198",borderWidth:n==="line"?2:1,pointRadius:n==="line"?2:void 0}]}},[a,p,C,n,m,B,R,M,F,y]),K=c.useMemo(()=>{for(const e of y)if(a.some(s=>v(s[e])!==null))return!0;return!1},[a,y]),V=O.datasets.length>1,D=n==="stacked-bar",X=c.useMemo(()=>({responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:V}},scales:{x:{title:{display:!0,text:p},...D?{stacked:!0}:{}},y:{title:{display:!0,text:y.length===1?y[0]:"Value"},...D?{stacked:!0}:{}}}}),[p,y,V,D]),Q=c.useMemo(()=>({responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0}}}),[]);function Z(){if(!K)return t.jsxs("div",{className:"duckdb-chart-message",children:["Y column “",y.join(", "),"” contains no numeric values"]});switch(n){case"bar":case"stacked-bar":return t.jsxs(t.Fragment,{children:[t.jsx(ne,{data:O,options:X}),n==="stacked-bar"&&!M&&O.datasets.length<=1&&t.jsx("div",{className:"duckdb-chart-message",style:{height:"auto",padding:"6px 0"},children:"Select a “Color By” column below to split bars into stacked segments"})]});case"line":return t.jsx(se,{data:O,options:X});case"scatter":{const e=y[0],s=a.map(i=>{const o=v(i[p]),h=v(i[e]);return o!==null&&h!==null?{x:o,y:h}:null}).filter(i=>i!==null);return t.jsx(ae,{data:{datasets:[{label:`${p} vs ${e}`,data:s,backgroundColor:"rgba(42, 161, 152, 0.6)",borderColor:"#2aa198"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{x:{title:{display:!0,text:p}},y:{title:{display:!0,text:e}}}}})}case"pie":{const e=y[0],s=a.slice(0,_).map(o=>o[p]??"NULL"),i=a.slice(0,_).map(o=>v(o[e])??0);return t.jsxs(t.Fragment,{children:[t.jsx(te,{data:{labels:s,datasets:[{data:i,backgroundColor:s.map((o,h)=>d[h%d.length]),borderColor:"#eee8d5",borderWidth:1}]},options:Q}),a.length>_&&t.jsxs("div",{className:"duckdb-chart-message",children:["Showing first ",_," of ",a.length," rows"]})]})}}}return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"duckdb-chart-controls",children:[t.jsxs("label",{style:w,children:["X Column",t.jsx("select",{value:p,onChange:e=>Y(e.target.value),children:l.map(e=>t.jsx("option",{value:e,children:e},e))})]}),t.jsxs("label",{style:w,children:["Y Column",t.jsx("select",{value:C,onChange:e=>{E(e.target.value),k.includes(e.target.value)||I([e.target.value])},children:l.map(e=>t.jsx("option",{value:e,children:e},e))})]}),t.jsxs("label",{style:w,children:["Chart Type",t.jsxs("select",{value:n,onChange:e=>{const s=e.target.value;S(s),s==="stacked-bar"&&A(!0)},children:[t.jsx("option",{value:"bar",children:"Bar"}),t.jsx("option",{value:"line",children:"Line"}),t.jsx("option",{value:"scatter",children:"Scatter"}),t.jsx("option",{value:"pie",children:"Pie"}),t.jsx("option",{value:"stacked-bar",children:"Stacked Bar"})]})]}),t.jsx("button",{className:"duckdb-chart-toggle",style:m?fe:$,onClick:()=>A(e=>!e),children:m?"Simple":"Advanced"})]}),m&&t.jsxs("div",{className:"duckdb-chart-advanced",style:ye,children:[t.jsxs("div",{children:[t.jsx("div",{style:{...w,marginBottom:4},children:"Y Columns"}),t.jsx("div",{className:"duckdb-chart-checkboxes",style:Ce,children:l.map(e=>t.jsxs("label",{style:{display:"flex",alignItems:"center",gap:4,cursor:"pointer"},children:[t.jsx("input",{type:"checkbox",checked:k.includes(e),onChange:()=>J(e),disabled:!!U,style:{accentColor:"var(--sol-cyan)"}}),t.jsx("span",{children:e}),t.jsx("span",{style:{color:"var(--base-1)",fontSize:10},children:be(x[e]??"other")})]},e))})]}),t.jsxs("div",{children:[t.jsx("div",{style:{...w,marginBottom:4},children:"Color By"}),t.jsxs("select",{value:U,onChange:e=>{G(e.target.value),e.target.value&&I([C])},style:{fontFamily:"'Cousine', 'Monaco', 'Consolas', monospace",fontSize:12,background:"var(--base-3)",color:"var(--base-00)",border:"1px solid rgba(147, 161, 161, 0.2)",borderRadius:4,padding:"3px 6px"},children:[t.jsx("option",{value:"",children:"None"}),q.map(e=>t.jsx("option",{value:e,children:e},e))]})]}),t.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:8,flexDirection:"column"},children:[t.jsxs("label",{style:{...w,display:"flex",alignItems:"center",gap:6,cursor:"pointer"},children:[t.jsx("input",{type:"checkbox",checked:B,onChange:e=>P(e.target.checked),style:{accentColor:"var(--sol-cyan)"}}),"Aggregate"]}),B&&t.jsxs("select",{value:R,onChange:e=>H(e.target.value),style:{fontFamily:"'Cousine', 'Monaco', 'Consolas', monospace",fontSize:12,background:"var(--base-3)",color:"var(--base-00)",border:"1px solid rgba(147, 161, 161, 0.2)",borderRadius:4,padding:"3px 6px"},children:[t.jsx("option",{value:"SUM",children:"SUM"}),t.jsx("option",{value:"AVG",children:"AVG"}),t.jsx("option",{value:"COUNT",children:"COUNT"}),t.jsx("option",{value:"MIN",children:"MIN"}),t.jsx("option",{value:"MAX",children:"MAX"})]})]})]}),t.jsx("div",{className:"duckdb-chart-container",children:Z()})]})}export{je as default};
